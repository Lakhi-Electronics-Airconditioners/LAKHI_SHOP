<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lakhi Airconditioners | AC Products</title>
    <link rel="icon" href="img/1x1-logo.png">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="DOWNLOADED CSS/fontawesome-free-6.7.2-web/css/all.css">
    <link rel="stylesheet" href="DOWNLOADED CSS/fontawesome-free-6.7.2-web/css/all.min.css">
</head>
<body>
    <div class="header-NAV">
        <div class="container">
            <div class="navbar">
                <div class="logo"><img src="img/NABR/log.jpg" width="125px"></div>
                <nav>
                    <ul id="Menuitems">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="products.html">All Products</a></li>
                        <li><a href="contact.html">Contact Us</a></li>
                        <li><a href="account.html">Account</a></li>
                    </ul>
                </nav>
                <a href="cart"><img src="img/NABR/SCI.png" width="30px"></a>
                <img src="img/NABR/menu.png" class="menu-icon" onclick="menutoggle()">
            </div>
        </div>
    </div>
    <div class="color-NAV"><br><br></div>

    <div class="small-container">
        <div class="small-container row row-2">
            <h2>AC Products</h2>
            <select id="sortProducts">
                <option value="default">Default Sorting (A-Z)</option>
                <option value="za">Sort Z-A</option>
                <option value="price_asc">Sort by Price: Low to High</option>
                <option value="price_desc">Sort by Price: High to Low</option>
                <option value="rating">Sort by Rating</option>
            </select>
        </div>
        
        <div class="small-container row" style="margin-top: 20px;">
            <div class="col-4">
                <label for="filterAcType">AC Type:</label>
                <select id="filterAcType">
                    <option value="">All AC Types</option>
                </select>
            </div>
            <div class="col-4">
                <label for="filterAcTr">AC TR:</label>
                <select id="filterAcTr">
                    <option value="">All TR</option>
                </select>
            </div>
            <div class="col-4">
                <label for="filterAcStar">AC Star Rating:</label>
                <select id="filterAcStar">
                    <option value="">All Stars</option>
                </select>
            </div>
        </div>
        
        <div class="row" id="productListContainer">
            <!-- Product cards will be rendered here by JavaScript -->
        </div>
    </div>

    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="foot-col-1">
                    <h3>Download Our App</h3>
                    <p>Download App for Android but not <u>iphone</u> for now</p>
                    <div class="app-logo">
                        <a href="https://gonativeio-apps.s3-accelerate.amazonaws.com/static/6675cb704ad00e517ecc6016/app-release.apk?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAYMYFO3A75OQPINCL%2F20250516%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20250516T124428Z&X-Amz-Expires=14400&X-Amz-Signature=203fc53e1989a4bbe8fc8eb5e0451d05cbd205c5ea781318237539ae6db7b7cd&X-Amz-SignedHeaders=host"><img src="img/NABR/apk-down.jpeg"></a>
                    </div>
                </div>
                <div class="foot-col-2">
                    <img src="img/log-w.png" width="200px">
                    <p>Our Purpose Is to give the best deal and products to the Many.</p>
                </div>
                <div class="foot-col-3">
                    <h3>Useful links</h3>
                    <ul>
                        <Li><a href="https://main.lakhiairconditioners.com/TAC">Terms and Conditions</a></Li>
                        <Li><a href="https://main.lakhiairconditioners.com/PP">Privacy Policy</a></Li>
                        <li><a href="https://lakhiairconditioners.com">INFO</a></li>
                        <li><a href="https://made.lakhiairconditioners.com">VIDEOS MADE</a></li>
                    </ul>
                </div>
                <div class="foot-col-4">
                    <h3>Follow us</h3>
                    <ul>
                        <Li><a href="https://www.instagram.com/lakhi_electronic_airconditions/">Instagram</a></Li>
                        <Li><a href="https://www.facebook.com/lakhielectronicsairconditioner">Facebook</a></Li>
                    </ul>
                    <h3 style="margin-top: 20px">Contact info</h3>
                    <ul>
                        <li><a href="tel:+919825513000">+919825513000</a></li>
                        <li><a href="mailto:info@lakhiairconditioners?subject=Feedback&amp;body=Hi%20there,%20I%20have%20some%20feedback%20for%20you.">info@lakhiairconditioners.com</a></li>
                        <li><a href="https://bc.lakhiairconditioners.com">Business-card</a></li>
                    </ul>
                </div>
            </div>
            <hr>
            <p class="copyright">copyright 2025 lakhiairconditioners<br>
               all right given to fontawesome for their icons
               <a href="https://www.flaticon.com/free-icons/menu" title="menu icons">Menu icons created by ariefstudio - Flaticon</a></p>

        </div>
    </div>
    <script>
        var Menuitems = document.getElementById('Menuitems')

        Menuitems.style.maxHeight = "0px";

        function menutoggle() {
            if (Menuitems.style.maxHeight == "0px") {
                Menuitems.style.maxHeight = "200px"
            } else {
                Menuitems.style.maxHeight = "0px";
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const productContainer = document.getElementById('productListContainer');
            const sortSelect = document.getElementById('sortProducts');
            let allProducts = []; // Stores all AC products fetched
            let displayedProducts = []; // Stores products currently displayed after filters/sorts

            // Get references to the filter elements
            const filterAcTypeSelect = document.getElementById('filterAcType');
            const filterAcTrSelect = document.getElementById('filterAcTr');
            const filterAcStarSelect = document.getElementById('filterAcStar');

            // Function to generate star ratings HTML based on a numeric rating
            function generateStars(rating) {
                let starsHTML = '';
                const fullStars = Math.floor(rating);
                const hasHalfStar = rating % 1 !== 0;
                const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);

                for (let i = 0; i < fullStars; i++) {
                    starsHTML += '<i class="fa-solid fa-star"></i>';
                }
                if (hasHalfStar) {
                    starsHTML += '<i class="fa-solid fa-star-half-stroke"></i>';
                }
                for (let i = 0; i < emptyStars; i++) {
                    starsHTML += '<i class="fa-regular fa-star"></i>';
                }
                return starsHTML;
            }

            // Function to render products into the container
            function renderProducts(productsToRender) {
                productContainer.innerHTML = ''; // Clear existing products
                if (productsToRender.length === 0) {
                    productContainer.innerHTML = '<p style="text-align: center; width: 100%;">No AC products found matching your criteria.</p>';
                    return;
                }

                // Get current filter selections to determine if TR/Type should be displayed
                const currentAcTypeFilter = filterAcTypeSelect.value;
                const currentAcTrFilter = filterAcTrSelect.value;

                productsToRender.forEach(product => {
                    const productDiv = document.createElement('div');
                    productDiv.classList.add('col-4', 'product-item');
                    productDiv.dataset.serialNo = product.serial_no; // Store serial_no as data attribute

                    // Standardize image path by replacing '/' with '!'
                    const imagePath = `img/PROC/${product.serial_no.replace(/\//g, '!')}.jpg`;
                    let ratingSourcePath = product.rating_source_icon ? product.rating_source_icon : '';
                    // Format price with Indian Rupee symbol and locale-specific numbering
                    let formattedPrice = product.price ? `₹${parseFloat(product.price).toLocaleString('en-IN')}` : 'Price not available';

                    // Determine the stars HTML or 'No rating' text
                    let stars = product.rating_stars !== null && product.rating_stars !== undefined ? generateStars(product.rating_stars) : 'No rating';

                    // Conditional display of AC Type and TR
                    let acTypeDisplay = '';
                    // Only show AC Type if product has one AND the AC Type filter is NOT active
                    if (product['AC-Type'] && currentAcTypeFilter === '') {
                        acTypeDisplay = `<p style="font-size: 14px; margin: 5px 0;">Type: ${product['AC-Type']}</p>`;
                    }

                    let acTrDisplay = '';
                    // Only show AC TR if product has one AND the AC TR filter is NOT active
                    if (product['AC-TR'] && currentAcTrFilter === '') {
                        acTrDisplay = `<p style="font-size: 14px; margin: 5px 0;">TR: ${product['AC-TR']} Ton</p>`;
                    }

                    // Initial size for Add to Cart for AC products
                    const initialSelectedSizeForCart = product['AC-TR'] ? `${product['AC-TR']} Ton` : 'N/A';


                    productDiv.innerHTML = `
                        <a href="product_detail.html?serial_no=${product.serial_no}" style="text-decoration: none; color: inherit;">
                            <img src="${imagePath}" alt="${product.name}">
                            <h4>${product.name} (S/N: ${product.serial_no})</h4>
                            <p>${formattedPrice}</p>
                            ${acTrDisplay} <!-- TR between price and type (or rating if type not shown) -->
                            ${acTypeDisplay} <!-- Type between TR and rating -->
                            <div class="rating">
                                <span>
                                    ${stars}
                                </span>
                                ${ratingSourcePath ? `<p style="font-size: 10px; margin: 0;">Based on <img src="${ratingSourcePath}" style="width: 30px; height: 10px; vertical-align: middle;"></p>` : ''}
                            </div>
                        </a>
                        <div class="add-to-cart-container" style="text-align: center; margin-top: 10px;">
                            <a href="#" class="btn-Cart add-to-cart-small" data-serial-no="${product.serial_no}" data-initial-size="${initialSelectedSizeForCart}" data-product-unit="${product.unit || 'unit'}">Add To Cart</a>
                        </div>
                    `;
                    productContainer.appendChild(productDiv);
                });
                updateTotalProductCount(productsToRender.length); // Update count after rendering
                addAddToCartEventListeners(); // Add event listeners after rendering
            }

            // Function to sort the currently displayed products
            function sortProducts(criteria) {
                let productsToSort = [...displayedProducts]; // Sort the currently displayed products
                switch (criteria) {
                    case 'za':
                        productsToSort.sort((a, b) => b.name.localeCompare(a.name));
                        break;
                    case 'price_asc':
                        productsToSort.sort((a, b) => parseFloat(a.price.replace('₹', '').replace(/,/g, '')) - parseFloat(b.price.replace('₹', '').replace(/,/g, '')));
                        break;
                    case 'price_desc':
                        productsToSort.sort((a, b) => parseFloat(b.price.replace('₹', '').replace(/,/g, '')) - parseFloat(a.price.replace('₹', '').replace(/,/g, '')));
                        break;
                    case 'rating':
                        // Ensure valid numbers for sorting by rating, treating null/undefined as 0
                        productsToSort.sort((a, b) => (b.rating_stars || 0) - (a.rating_stars || 0));
                        break;
                    case 'default':
                    default:
                        productsToSort.sort((a, b) => a.name.localeCompare(b.name)); // Sort A-Z by default
                        break;
                }
                displayedProducts = productsToSort; // Update displayedProducts after sorting
                renderProducts(displayedProducts); // Re-render with sorted products
            }

            // Function to filter products based on selected dropdown values
            function filterProducts() {
                const selectedAcType = filterAcTypeSelect.value;
                const selectedAcTr = filterAcTrSelect.value;
                const selectedAcStar = filterAcStarSelect.value;

                let filtered = allProducts.filter(product => {
                    const acTypeMatch = !selectedAcType || (product["AC-Type"] && product["AC-Type"].toString() === selectedAcType);
                    const acTrMatch = !selectedAcTr || (product["AC-TR"] && product["AC-TR"].toString() === selectedAcTr);
                    const acStarMatch = !selectedAcStar || (product["AC-STAR"] && product["AC-STAR"].toString() === selectedAcStar);
                    
                    return acTypeMatch && acTrMatch && acStarMatch;
                });
                
                displayedProducts = filtered; // Update displayedProducts with filtered results
                sortProducts(sortSelect.value); // Apply current sort order to filtered results
            }

            // Helper function to populate filter dropdowns with unique values
            function populateFilterOptions(propertyName, selectElement) {
                const uniqueValues = [...new Set(allProducts.map(product => product[propertyName]).filter(value => value !== null && value !== undefined))];
                
                selectElement.querySelectorAll('option:not([value=""])').forEach(option => option.remove());

                uniqueValues.sort((a, b) => {
                    // Custom sort for numbers (like TR and STAR), otherwise localeCompare for strings
                    if (typeof a === 'number' && typeof b === 'number') {
                        return a - b;
                    }
                    return String(a).localeCompare(String(b));
                }).forEach(value => {
                    const option = document.createElement('option');
                    option.value = value;
                    // Special handling for AC-TR to add " Ton" suffix if it's a number
                    option.textContent = (propertyName === 'AC-TR' && typeof value === 'number') ? `${value} Ton` : value;
                    selectElement.appendChild(option);
                });
            }

            // Function to add/update the total product count display
            function updateTotalProductCount(count) {
                let totalProductsElement = document.getElementById('totalProductsCount');
                if (!totalProductsElement) {
                    totalProductsElement = document.createElement('p');
                    totalProductsElement.id = 'totalProductsCount';
                    totalProductsElement.style.marginTop = '20px';
                    productContainer.parentElement.appendChild(totalProductsElement);
                }
                totalProductsElement.textContent = `Total AC Products: ${count}`;
            }

            // --- Cart Functions (modified to accept and store 'unit') ---
            function getCartItems() {
                const cartItemsString = localStorage.getItem('cartItems');
                return cartItemsString ? JSON.parse(cartItemsString) : [];
            }

            function saveCartItems(cartItems) {
                localStorage.setItem('cartItems', JSON.stringify(cartItems));
            }

            // Updated addToCart to accept 'unit'
            function addToCart(serialNo, quantity, size, unit) {
                let cartItems = getCartItems();
                // Find if item with same serialNo AND size (variant) already exists
                const existingItemIndex = cartItems.findIndex(item => item.serial_no === serialNo && item.size === size);

                if (existingItemIndex > -1) {
                    cartItems[existingItemIndex].quantity += quantity;
                } else {
                    // Store the unit when adding a new item to cart
                    cartItems.push({ serial_no: serialNo, quantity: quantity, size: size, unit: unit });
                }
                saveCartItems(cartItems);
                alert(`Added ${quantity} ${unit} of ${serialNo} (Size: ${size}) to cart!`); // Updated alert
                console.log('Current cart:', cartItems);
            }

            function addAddToCartEventListeners() {
                document.querySelectorAll('.add-to-cart-small').forEach(button => {
                    button.addEventListener('click', function(event) {
                        event.preventDefault(); // Prevent default link behavior
                        const serialNo = this.dataset.serialNo;
                        const initialSize = this.dataset.initialSize || 'N/A'; 
                        const productUnit = this.dataset.productUnit || 'unit'; // Get the unit from data attribute

                        // For product listing, always add 1 quantity when clicking the button
                        addToCart(serialNo, 1, initialSize, productUnit); // Pass unit to addToCart
                    });
                });
            }
            // --- End Cart Functions ---


            // Fetch product data when the DOM is fully loaded
            fetch('products_data.js') // Ensure this path is correct relative to AC-only.html
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json(); // Parse response as JSON
                })
                .then(data => {
                    // Filter for only 'AC' type products for this page
                    allProducts = data.filter(product => product.type === 'AC');
                    displayedProducts = [...allProducts]; // Initialize displayed products

                    // Initial render of all AC products
                    renderProducts(displayedProducts);

                    // Populate filter dropdowns with AC-specific data
                    populateFilterOptions('AC-Type', filterAcTypeSelect);
                    populateFilterOptions('AC-TR', filterAcTrSelect);
                    populateFilterOptions('AC-STAR', filterAcStarSelect);
                    
                    // Add event listeners for sorting and filtering
                    sortSelect.addEventListener('change', () => {
                        sortProducts(sortSelect.value);
                    });
                    filterAcTypeSelect.addEventListener('change', filterProducts);
                    filterAcTrSelect.addEventListener('change', filterProducts);
                    filterAcStarSelect.addEventListener('change', filterProducts);
                })
                .catch(error => console.error('Error loading product data:', error));
        });
    </script>
</body>
</html>
