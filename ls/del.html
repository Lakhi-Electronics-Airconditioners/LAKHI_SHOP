<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lakhi Airconditioners | Delete Account</title>
    <meta name="description" content="Delete you account">
    <link rel="icon" href="../img/1x1-logo.png">
    <link rel="stylesheet" href="../styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../DOWNLOADED CSS/fontawesome-free-6.7.2-web/css/all.css">
    <link rel="stylesheet" href="../DOWNLOADED CSS/fontawesome-free-6.7.2-web/css/all.min.css">
    <script src="../data.js"></script>
    <style>
        .delete-account-container {
            max-width: 600px;
            margin: 80px auto;
            padding: 40px;
            background: #fff;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border-radius: 10px;
            text-align: center;
        }

        .delete-account-container h1 {
            color: #d9534f; /* Red for warning */
            margin-bottom: 20px;
        }

        .delete-account-container p {
            color: #666;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .input-container {
            margin-bottom: 20px;
            text-align: left;
        }

        .input-container label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        .input-container input[type="password"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .btn-delete {
            display: inline-block;
            background: #d9534f; /* Red for delete action */
            color: #fff;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .btn-delete:hover {
            background: #c9302c; /* Darker red on hover */
        }

        .message-box {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            font-size: 1em;
            display: none; /* Hidden by default */
            text-align: center;
        }

        .message-box.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message-box.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .message-box.loading {
            background-color: #e2e3e5;
            color: #383d41;
            border: 1px solid #d6d8db;
        }
    </style>
</head>
<body>

    <!-- Header -->
    <div class="header-NAV">
        <div class="container">
            <div class="navbar">
                <div class="logo"><img src="../img/NABR/log.jpg" width="125px" alt="lakhi airconditioners Logo"></div>
                <nav>
                    <ul id="Menuitems">
                        <li><a href="https://shop.lakhiairconditioners.com">Home</a></li>
                        <li><a href="../about">About Us</a></li>
                        <li><a href="../AC-only">AC Products</a></li>
                        <li><a href="../contact">Contact Us</a></li>
                        <li><a href="../account">Account</a></li>
                    </ul>
                </nav>
                <a href="../cart"><img src="../img/NABR/SCI.png" width="30px" height="30px" alt="Shopping Cart"></a>
                <img src="../img/menu.png" class="menu-icon" onclick="menutoggle()" alt="Menu Icon">
            </div>
        </div>
    </div>
    <!-- End Header -->
     <div class="color-NAV">
        <br><br>
        <a href="#" class="back-button" onclick="history.back(); return false;">&larr; Back</a>
    </div>

    <div class="delete-account-container">
        <h1>Delete Your Account</h1>
        <p>
            Deleting your account is a permanent action and cannot be undone.
            All your data associated with this account will be removed.
            Please confirm your decision by entering your password below.
            <br>
            to added a password <a href="../ls/forgot-password.html">forgot-password</a>
        </p>
        <form id="deleteAccountForm">
            <div class="input-container">
                <label for="password">Enter Your Password to Confirm</label>
                <input type="password" id="password" required>
            </div>
            <button type="submit" class="btn-delete">Confirm Account Deletion</button>
        </form>
        <div id="messageBox" class="message-box"></div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="foot-col-1">
                    <h3>Download Our App</h3>
                    <p>Download App for Android but not <u>iphone</u>for now</p>
                    <div class="app-logo">
                        <a href="https://drive.google.com/uc?export=download&id=1jx18KtEjAwaQtto0XqbPWe8cz49oUuUG"><img src="img/NABR/apk-down.jpeg" alt="Download App"></a>
                    </div>
                </div>
                <div class="foot-col-2">
                    <img src="img/log-w.png" width="200px" alt="Lakhi Airconditioners Logo">
                    <p>Our Purpose Is to give the best deal and products to the Many.</p>
                </div>
                <div class="foot-col-3">
                    <h3>Useful links</h3>
                    <ul>
                        <Li><a href="https://main.lakhiairconditioners.com/TAC">Terms and Conditions</a></Li>
                        <Li><a href="https://main.lakhiairconditioners.com/PP">Privacy Policy</a></Li>
                        <li><a href="https://lakhiairconditioners.com">INFO</a></li>
                        <li><a href="https://maps.lakhiairconditioners.com">G-MAPS</a></li>
                    </ul>
                </div>
                <div class="foot-col-4">
                    <h3>Follow us</h3>
                    <ul>
                        <Li><a href="https://insta.lakhiairconditioners.com/">Instagram</a></Li>
                        <Li><a href="https://fb.lakhiairconditioners.com/">Facebook</a></Li>
                    </ul>
                    <h3 style="margin-top: 20px">Contact Info</h3>
                    <ul>
                        <li><a href="tel:+919825513000">+919825513000</a></li>
                        <li><a href="mailto:info@lakhiairconditioners?subject=Feedback&amp;body=Hi%20there,%20I%20have%20some%20feedback%20for%20you.">info@lakhiairconditioners.com</a></li>
                        <li><a href="https://bc.lakhiairconditioners.com">Business-card</a></li>
                    </ul>
                </div>
            </div>
            <hr>
            <p class="copyright">&copy; 2025 Lakhi Airconditioners. All rights reserved.<br>
                all right given to fontawesome for their icons
                <a href="https://www.flaticon.com/free-icons/menu" title="menu icons">Menu icons created by ariefstudio - Flaticon</a></p>

        </div>
    </div>
    <!-- End Footer -->

<script type="module">
    // Firebase SDK imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, deleteUser, EmailAuthProvider, reauthenticateWithCredential } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // IMPORTANT: Replace with your actual Firebase config
    const firebaseConfig = {
        apiKey: "AIzaSyC-16u2n4IaGRmg88nsPmMYCGKp2jjL9Bg",
        authDomain: "lakhi-airconditioners.firebaseapp.com",
        projectId: "lakhi-airconditioners",
        storageBucket: "lakhi-airconditioners.firebasestorage.app",
        messagingSenderId: "284430318185",
        appId: "1:284430318185:web:ad09598be7a16ab46a00f8",
        measurementId: "G-LB63B1FRYC"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Get DOM elements
    const deleteAccountForm = document.getElementById('deleteAccountForm');
    const passwordInput = document.getElementById('password');
    const messageBox = document.getElementById('messageBox');

    // Function to show messages
    function showMessage(type, message) {
        messageBox.textContent = message;
        messageBox.className = `message-box ${type}`;
        messageBox.style.display = 'block';
    }

    // Check auth state on page load
    onAuthStateChanged(auth, (user) => {
        if (!user) {
            // If user is not logged in, redirect to login page
            showMessage('error', 'You must be logged in to delete your account. Redirecting to login page...');
            setTimeout(() => {
                window.location.href = '../ls'; // Adjust this path if needed
            }, 3000);
        }
    });

    deleteAccountForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const user = auth.currentUser;
        if (!user) {
            showMessage('error', 'You are not logged in. Please log in to delete your account.');
            return;
        }

        const password = passwordInput.value;

        showMessage('loading', 'Deleting account...');

        try {
            // Re-authenticate the user before deleting the account
            // This is a security measure required by Firebase
            const credential = EmailAuthProvider.credential(user.email, password);
            await reauthenticateWithCredential(user, credential);

            // Once re-authenticated, proceed with deletion
            await deleteUser(user);

            // Optionally, delete user data from Firestore as well
            // This assumes your user profiles are stored under 'artifacts/{projectId}/users/{userId}/user_profiles/profile'
            const appId = firebaseConfig.projectId;
            const userProfileDocRef = doc(db, `artifacts/${appId}/users/${user.uid}/user_profiles`, "profile");
            await deleteDoc(userProfileDocRef);
            console.log("User profile document deleted from Firestore.");

            showMessage('success', 'Account deleted successfully! Redirecting to home page...');

            // Redirect to home page or login page after successful deletion
            setTimeout(() => {
                window.location.href = '../'; // Adjust this path if needed
            }, 3000);

        } catch (error) {
            console.error("Error deleting account:", error);
            let errorMessage = "Failed to delete account. Please try again.";

            if (error.code === 'auth/requires-recent-login') {
                errorMessage = "For security, please log out and log in again, then try deleting your account.";
            } else if (error.code === 'auth/wrong-password') {
                errorMessage = "Incorrect password. Please try again.";
            } else if (error.code === 'auth/invalid-credential') {
                errorMessage = "Authentication failed. Please check your password.";
            } else if (error.code === 'auth/user-mismatch') {
                errorMessage = "User mismatch. Please ensure you are logged in with the correct account.";
            } else if (error.code === 'auth/email-already-in-use') {
                errorMessage = "Email already in use. This error should not occur during deletion.";
            } else if (error.code === 'auth/invalid-email') {
                errorMessage = "Invalid email. This error should not occur during deletion.";
            } else if (error.code === 'auth/network-request-failed') {
                errorMessage = "Network error. Please check your internet connection.";
            }
            showMessage('error', errorMessage);
        }
    });

    // Mobile menu toggle (from your original HTML)
    var Menuitems = document.getElementById("Menuitems");
    if (Menuitems) {
        Menuitems.style.maxHeight = "0px";
        window.menutoggle = function() {
            if (Menuitems.style.maxHeight == "0px") {
                Menuitems.style.maxHeight = "200px";
            } else {
                Menuitems.style.maxHeight = "0px";
            }
        };
    } else {
        console.warn("Menuitems element not found for mobile toggle.");
    }
</script>
</body>
</html>
